# Blender-Uma-Addon
本插件基于Blender 4.5.7 LTS开发，可用于简化处理从**umaviewer**导出的赛马娘模型的操作。其包含的功能有骨架分层、生成控制器、快速修复迷你赛马娘模型等。在以下版本中测试插件，功能正常。在4.0.0版本以下，插件一定无法正常运行所有功能。  

        4.5.7 LTS，4.2.17 TLS  
如果插件无法正常工作，请尝试切换到推荐版本处理模型后，再追加到你正在使用的版本，或者进行反馈（无法及时回复）。如果仍然无法解决问题，请进行反馈。

## 功能  Functions
安装插件后，本插件的面板会出现在MMD面板中。

**骨架分层**  
从umaviewer直接导出的赛马娘模型，骨骼繁多，不便操控。选中骨架后点击骨架分层，插件就会创建多个骨骼集合，将除主体骨骼外的其他骨骼隐藏，你可以随时调整这些骨骼集合的可见性，从而控制你想控制的骨骼。 

**优化形态**  
为从umaviewer直接导出的赛马娘模型创建左右眼对称的形态键，并添加驱动器，使其可以被眼部骨骼的旋转控制；调整部分末端骨骼的形态；将躯干中原本就相连的骨骼设置为相连项。

**删除**  
选中骨架后点击删除，选中的骨骼集合就会被删除，其中Face集合中的骨骼权重会被转移给骨骼Head，如果选中的骨骼集合中存在你想保留的骨骼，请将你想保留的骨骼提前移出该骨骼集合。

**着色**  
选中网格后点击着色，选中的模型就会被直接添加上赛马娘着色，并自动匹配贴图和调整参数。  

本插件只是提供一键应用赛马娘着色的功能。如果出现插件一键应用赛马娘着色的效果与原项目不同等由本插件造成的问题，请进行反馈。如果对着色效果有疑问请咨询原作者。

赛马娘着色项目原地址，目前使用的是Umashaders v0.2.4，如果更新了可以提醒我一下。
>https://github.com/LooperHonstropy/BLENDER-Uma-Musume-Pretty-Derby-Shaders

**修复迷你赛马娘模型**  
处理方法参考
>https://www.bilibili.com/video/BV1LhbGzQEUY

**自动捩骨**  
为选中模型的ShoulderRoll和ArmRoll添加约束，自动调整其朝向。  
请不要在使用MMR控制器或者其他已经有自动捩骨功能的控制器的情况下再启用此功能。

**生成 IK**  
为选中模型生成简单的IK控制器。

**烘焙 FK 到 IK**  
在场景帧范围内，把选中模型原本就有的FK动作烘焙到上述 *生成 IK* 操作生成的IK控制器上。

**为赛马娘**  
如果你安装了MikuMikuRig 4.5-1.92 LTS，在MMR的主面板下就会出现这个按钮，点击后可以直接为赛马娘生成控制器。
如果你先安装此插件，后安装MMR，需要重启此插件，这个按钮才能显示。
>https://github.com/XiaoFFGe/MikuMikuRig  
>https://wwcb.lanzn.com/b00taqmfwb 密码:6666

**物理**  
选中骨架后可以为相应部位启用物理效果。只是添加上简单的阻尼追踪。

**纹狸**  
在着色器编辑器的纹理中新增纹狸节点。可以按照不同速率循环播放GIF。  
此节点的典型用法是添加图像为网格平面后，把其中的图像纹理节点替换为纹狸节点，这样你就可以获得一个循环播放GIF的网格平面。  
使用此节点需要安装依赖库Pillow，可以在插件的偏好设置处安装。
此节点会在Appdata/Local处生成缓存。若源GIF的地址没有变化，则缓存可以复用。

**改变狸**  
在着色器编辑器的转换器中新增改变狸节点。可以从多个图像输入中选择一个作为输出。

## 反馈  Feedback
https://www.bilibili.com/opus/1101994702993883141?spm_id_from=333.1387.0.0
